kango.EventTargetWrapper=function(a){var b=kango.oop.createProxy(a),c=[];b.addEventListener=function(b,d){return a.addEventListener(b,d)?(c.push({type:b,listener:d}),!0):!1};b.__clearWrapper=function(){kango.array.forEach(c,function(b){a.removeEventListener(b.type,b.listener)});c=[]};return b};
kango.MessageTargetWrapper=function(a){var b=kango.oop.createProxy(a),c=[];b.addMessageListener=function(b,d){return a.addMessageListener(b,d)?(c.push({name:b,listener:d}),!0):!1};b.__clearWrapper=function(){kango.array.forEach(c,function(b){a.removeMessageListener(b.name,b.listener)});c=[]};return b};
kango.KangoEventWrapper=function(a){var b=new kango.MessageTargetWrapper(a);b.ui=kango.oop.createProxy(a.ui);b.ui.browserButton=new kango.EventTargetWrapper(a.ui.browserButton);b.browser=new kango.EventTargetWrapper(a.browser);return b};kango.HTMLSandbox=function(){this._browserId="kango-background-script-host_"+kango.utils.getDomainFromId(kango.getExtensionInfo().id);this._frameEventListener=null};
kango.HTMLSandbox.prototype={_browserId:null,_frameEventListener:null,create:function(a,b){var c=kango.chromeWindows.getHiddenWindow(),e=c.document.createElementNS(XHTML_NS,"iframe");e.setAttribute("type","chrome");e.setAttribute("id",this._browserId);this._frameEventListener=function(a){a=a.target.defaultView.wrappedJSObject;var c=new kango.KangoEventWrapper(kango);a.onunload=function(){c.__clearWrapper();c.browser.__clearWrapper();c.ui.browserButton.__clearWrapper()};b(a,c)};e.addEventListener("DOMContentLoaded",
this._frameEventListener,!1);e.setAttribute("src",kango.io.getExtensionFileUrl(a));c.document.documentElement.appendChild(e)},dispose:function(){var a=kango.chromeWindows.getHiddenWindow().document.getElementById(this._browserId);a.removeEventListener("DOMContentLoaded",this._frameEventListener,!1);a.parentNode.removeChild(a)}};kango.Lang=function(){};
kango.Lang.prototype=kango.oop.extend(kango.LangBase,{_executeScript:function(a,b){try{null!=a.path?Services.scriptloader.loadSubScript(a.path,b,"UTF-8"):Cu.evalInSandbox(a.text,b,"default",a.path,1)}catch(c){kango.console.reportError(c,a.path)}},makeDataExposed:function(a){a.__exposedProps__=a.__exposedProps__||{};for(var b in a)"__exposedProps__"!=b&&a.hasOwnProperty(b)&&(a.__exposedProps__[b]="wr",null!=a[b]&&kango.object.isObject(a[b])&&kango.lang.makeDataExposed(a[b]));return a},createHTMLSandbox:function(a,
b){var c=new kango.HTMLSandbox;c.create(a,b);return c},evalScriptsInSandbox:function(a,b,c){"undefined"!=typeof b.kango&&null!=a&&(b.kango=kango.browser.getTabProxyForWindow(a));var e=new Components.utils.Sandbox(a,{sandboxPrototype:a,wantXrays:!0}),d;for(d in b)b.hasOwnProperty(d)&&(e[d]=b[d]);kango.array.forEach(c,function(a){kango.array.forEach(a.requires,function(a){this._executeScript(a,e)},this);this._executeScript(a,e)},this)}});kango.registerModule(kango.getDefaultModuleRegistrar("lang",kango.Lang));
